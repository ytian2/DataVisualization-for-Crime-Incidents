<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

<style>

table{
  border-collapse:collapse;
  border-spacing:0;
  border-left:1px solid #888;
  border-top:1px solid #888;
  border-right:1px solid #888;
  border-bottom:1px solid #888;
  background:#efefef;
  margin-left: 50px;
  margin-top:50px;
  margin-right:auto;
  text-align: center;
  width: 50%;
}

.axis {
	font: 10px sans-serif;
}

.axis path,
.aixs line {
	fill: none;
	stroke: #000;
	shape-rendering: crispEdges;
}

.arc text {
	font-family: sans-serif;
	font-size: 11px;
}

.legend {
  font-size: 11px;
  font-family: sans-serif;
}

#container{
  width: 1000px;
  height:600px;
  float:left;
}

#pie{
  width: 500px;
  height:400px;
  float:left;
  margin-top:10px;
}

#textBox{
  width: 500px;
  height:500px;
  float:left;
  margin-top:10px;
}

td, th {
    padding: 1px 4px;
}


</style>

</head>
<body>
  <div id="container">


<h1 align="Center">Final Project Of CS573 Data Visualization</h1>
<hr />

<h3 align="Center">Authors: Yu Tian, Naihui Wang, Yang Liu</h3>


<div id="pie"></div>
<div id="textBox"></div>

</div>


<!-- This is a comment -->

</body>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://code.jquery.com/jquery.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

<script>

var width=900;
var height=500;
var radius=Math.min(width,height)/4;
//var padding={left:30, right:30, top:20, bottom:20};
var color=d3.scale.category10();

var arc=d3.svg.arc()
	.outerRadius(radius-10)
	.innerRadius(0);

var pie=d3.layout.pie()
	.sort(null)
	.value(function(d) {return d.FREQ;});

var WEAPONTYPE=["Blunt Object", "Firearm", "Knife", "Knife/Cutting Instrument",
"None", "Other", "Personal Weapon (hand  foot  etc.)", "Unarmed"];


var svg=d3.select("#pie")
	.append("svg")
	.attr("width",width)
	.attr("height",height)
	.append("g")
    .attr("transform", "translate(" + 380 + "," + 130 + ")");


d3.csv("data/weaponType.csv", function(error,data){
	if(error) console.log(error);

	//append a group
	var g=svg.selectAll(".arc")
		.data(pie(data))
		.enter().append("g")
		.attr("class","arc")
		.on("mouseover", function(d){
           showBox(d.data.WEAPONTYPE);
           //console.log("dValue" + d.data.WEAPONTYPE);
		});

	//append path, the pie for each type
	g.append("path")
		.attr("d",arc)
		.style("fill",function(d,i){return color(i);});

//add legend----------------------------------------------
var legend = svg.selectAll(".legend")
                    .data(data)
                    .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function (d, i) {return "translate(0," + i * 20 + ")";});

    legend.append("rect")
          .attr("x", -150)
          .attr("y",-70)
          .attr("width", 23)
          .attr("height", 13)
          .attr("d",legend)
          .style("fill", function(d,i) { return color(i);});

    legend.append("text")
          .attr("x", -160)
          .attr("y", -65)
          .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function (d) {return d.WEAPONTYPE;});


// The table generation function
//WEAPONTYPEs: Blunt Object, Firearm, Knife, Knife/Cutting Instrument, None, Other,
//Personal Weapon (hand foot etc.), Unarmed

/*--------------call box-------------------*/

function showBox(weaponType){

	var description;

  console.log("weapontype" + weaponType);
	
	data.forEach(function(d){
		if(weaponType=="Blunt Object"){ description ="The choices are simple... Run away, or close the distance and strike while defending.  Staying in range of the stick, but out of range to counter attack, is potentially the biggest mistake you could make in this situation.  Remember, the stick will be moving fastest at the point furthest from the attackers arm, so getting inside that point on the stick is crucial.";}
		else if(weaponType=="Firearm"){ description="Never let your gun Pointed be at anyone.Be sure of your target before you pull the trigger.Do not mix gunpowder and alcohol.";}
		else if(weaponType=="Knife"){ description="Concentrate on what you’re doing when using a knife. Do not engage in conversation when using knives; pay attention to the task underway.";}
		else if(weaponType=="Knife/Cutting Instrument"){ description="Do not hold food in your hand while you cut it. Always cut on the cutting board. Always keep fingers on top of the blade in case it slips.";}
		else if(weaponType=="None"){ description="None :-)";}
		else if(weaponType=="Other"){ description="Not Sure :-(";}
		else if(weaponType=="Personal Weapon (hand foot etc.)"){ description="If a robber asks for your wallet and/or purse, DO NOT HAND IT TO HIM. Toss it away from you....chances are that he is more interested in your wallet and/or purse than you, and he will go for the wallet/purse. RUN LIKE MAD IN THE OTHER DIRECTION! If you are ever thrown into the trunk of a car, kick out the back tail lights and stick your arm out the hole and start waving like crazy. The driver won't see you, but everybody else will. This has saved lives. ";}
		else if(weaponType=="Unarmed"){ description="Still Watch out, please! :-)";}
		
		return;
	});

var descript = [{Tips: description}];

tabulate(descript,["Tips"]);
//console.log("des" + descript);

};

/*--------------Create Table---------------*/

function tabulate(text,columns) {

  d3.selectAll("table").remove();
  
  console.log("des" + text);

    var table = d3.select("#textBox").append("table");
    
    var thead = table.append("thead"),
        tbody = table.append("tbody");

    // append the header row
    thead.append("tr")
        .selectAll("th")
        .data(columns)
        .enter()
        .append("th")
            .text(function(column) { return column; });

    // create a row for each object in the data
    var rows = tbody.selectAll("tr")
        .data(text)
        .enter()
        .append("tr");

    // create a cell in each row for each column
    var cells = rows.selectAll("td")
        .data(function(row) {
            return columns.map(function(column) {
                return {column: column, value: row[column]};
            });
        })
        .enter()
        .append("td")
            .text(function(d) { return d.value; });
    
    return table;
}


});


</script>



</html>
